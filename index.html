<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Data Visualizations</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .chart {
            margin: 20px;
        }
        .axis path, .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .grid line {
            stroke: #ccc;
            stroke-dasharray: 3 3;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: 80px;
            height: 28px;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
        .pie-chart path {
            stroke: white;
            stroke-width: 1;
        }
    </style>
</head>
<body>
    <h1>EV Data Visualizations</h1>

    <!-- Visualization Divs -->
    <div id="charging-points-bar-chart" class="chart"></div>
    <div id="ev-sales-bar-chart" class="chart"></div>
    <div id="charging-points-pie-chart" class="chart"></div>
    <div id="ev-sales-pie-chart" class="chart"></div>
    <div id="charging-points-scatter" class="chart"></div>

    <script>
        // Bar chart helper function
        function createBarChart(svg, data, x, y, title, xAxisLabel, yAxisLabel) {
            const margin = { top: 40, right: 30, bottom: 50, left: 70 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            svg.attr("width", width + margin.left + margin.right)
               .attr("height", height + margin.top + margin.bottom)
               .append("g")
               .attr("transform", `translate(${margin.left},${margin.top})`);

            x.domain(data.map(d => d.year));
            y.domain([0, d3.max(data, d => d.value)]);

            svg.select("g")
               .append("g")
               .attr("transform", `translate(0,${height})`)
               .call(d3.axisBottom(x));

            svg.select("g")
               .append("g")
               .call(d3.axisLeft(y));

            svg.select("g")
               .selectAll(".bar")
               .data(data)
               .enter().append("rect")
               .attr("class", "bar")
               .attr("x", d => x(d.year))
               .attr("y", d => y(d.value))
               .attr("width", x.bandwidth())
               .attr("height", d => height - y(d.value))
               .attr("fill", "steelblue");

            svg.append("text")
               .attr("x", width / 2)
               .attr("y", height + margin.bottom - 10)
               .style("text-anchor", "middle")
               .text(xAxisLabel);

            svg.append("text")
               .attr("transform", "rotate(-90)")
               .attr("y", 0 - margin.left)
               .attr("x", 0 - (height / 2))
               .style("text-anchor", "middle")
               .text(yAxisLabel);

            svg.append("text")
               .attr("x", width / 2)
               .attr("y", 0 - margin.top / 2)
               .style("text-anchor", "middle")
               .text(title);
        }

        // Bar chart for Charging Points
        d3.csv("Dev 1/datasets/EV charging pointsHistoricalEV.csv").then(data => {
            const svg = d3.select("#charging-points-bar-chart").append("svg");
            const x = d3.scaleBand().range([0, 800]).padding(0.1);
            const y = d3.scaleLinear().range([500, 0]);
            createBarChart(svg, data, x, y, "EV Charging Points Over Time", "Year", "Charging Points");
        });

        // Bar chart for EV Sales
        d3.csv("Dev 1/datasets/EV salesHistoricalBuses.csv").then(data => {
            const svg = d3.select("#ev-sales-bar-chart").append("svg");
            const x = d3.scaleBand().range([0, 800]).padding(0.1);
            const y = d3.scaleLinear().range([500, 0]);
            createBarChart(svg, data, x, y, "EV Sales (Buses) Over Time", "Year", "Sales");
        });

        // Pie chart helper function
        function createPieChart(svg, data, title) {
            const width = 400, height = 400, radius = Math.min(width, height) / 2;
            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const pie = d3.pie().value(d => d.value);
            const arc = d3.arc().outerRadius(radius - 10).innerRadius(0);
            const labelArc = d3.arc().outerRadius(radius - 40).innerRadius(radius - 40);

            const g = svg.append("g").attr("transform", `translate(${width / 2},${height / 2})`);
            const arcs = g.selectAll(".arc").data(pie(data)).enter().append("g").attr("class", "arc");

            arcs.append("path")
                .attr("d", arc)
                .style("fill", d => color(d.data.category));

            arcs.append("text")
                .attr("transform", d => `translate(${labelArc.centroid(d)})`)
                .style("text-anchor", "middle")
                .text(d => d.data.category);

            svg.append("text")
               .attr("x", width / 2)
               .attr("y", 20)
               .style("text-anchor", "middle")
               .text(title);
        }

        // Pie chart for Charging Points
        d3.csv("Dev 1/datasets/EV charging pointsHistoricalEV.csv").then(data => {
            const svg = d3.select("#charging-points-pie-chart").append("svg").attr("width", 400).attr("height", 400);
            createPieChart(svg, data, "EV Charging Points Distribution");
        });

        // Scatter plot helper function
        function createScatterPlot(svg, data, title, x, y) {
            const margin = { top: 40, right: 30, bottom: 50, left: 70 };
            const width = 800 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            svg.attr("width", width + margin.left + margin.right)
               .attr("height", height + margin.top + margin.bottom)
               .append("g")
               .attr("transform", `translate(${margin.left},${margin.top})`);

            x.domain(d3.extent(data, d => +d.year));
            y.domain([0, d3.max(data, d => +d.value)]);

            svg.select("g")
               .append("g")
               .attr("transform", `translate(0,${height})`)
               .call(d3.axisBottom(x));

            svg.select("g")
               .append("g")
               .call(d3.axisLeft(y));

            svg.select("g")
               .selectAll(".dot")
               .data(data)
               .enter().append("circle")
               .attr("class", "dot")
               .attr("cx", d => x(d.year))
               .attr("cy", d => y(d.value))
               .attr("r", 5)
               .attr("fill", "steelblue");
        }

        // Scatter plot for Charging Points
        d3.csv("Dev 1/datasets/EV charging pointsHistoricalEV.csv").then(data => {
            const svg = d3.select("#charging-points-scatter").append("svg");
            const x = d3.scaleLinear().range([0, 800]);
            const y = d3.scaleLinear().range([500, 0]);
            createScatterPlot(svg, data, "EV Charging Points Scatter", x, y);
        });

    </script>
</body>
</html>
