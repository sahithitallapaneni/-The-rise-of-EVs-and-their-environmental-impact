<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rise of EVs & Environmental Impact</title>
    <style>
        /* Base Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }

        /* Huge Main Heading */
        header {
            color: black;
            text-align: center;
            padding: 80px 20px;
        }
        h1:hover {
            transform: scale(1.2);  /* Makes the heading grow */
            color: #f1c40f;         /* Changes color to gold */
        }

        header h1 {
            font-size: 4rem;
            margin: 0;
            animation: fadeIn 2s ease-in-out;
        }

        /* Side Headings */
        .section-title {
            font-size: 2.5rem;
            text-align: center;
            margin: 60px 0 20px;
            color: #2c3e50;
            transition: transform 0.3s ease;
        }

        .section-title:hover {
            transform: scale(1.1);
            color: #e74c3c;
        }

        /* Section Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .content-section {
            margin-bottom: 60px;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            animation: slideIn 1s ease-in-out;
        }

        .content-section p {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #555;
        }

        /* Footer */
        footer {
            background: #34495e;
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        footer p {
            margin: 0;
            font-size: 1rem;
        }

        /* Keyframe Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive Layout */
        @media (max-width: 768px) {
            header h1 {
                font-size: 3rem;
            }

            .section-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>

    <!-- Main Header -->
    <header>
        <h1>Rise of EVs & Their Environmental Impact</h1>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Section 1: Rise of EV -->
        <div class="section-title">Rise of EV</div>
        <div class="content-section">
            <p>The rise of Electric Vehicles (EVs) marks a transformative era in transportation. With advancements in battery technology and global initiatives to reduce carbon emissions, EVs are rapidly gaining traction worldwide.</p>
        </div>

        <!-- Section 2: Environmental Impact -->
        <div class="section-title">Environmental Impact</div>
        <div class="content-section">
            <p>EVs significantly reduce greenhouse gas emissions compared to traditional vehicles. However, understanding their full environmental impact requires considering electricity sources and battery production emissions.</p>
        </div>

        <!-- Section 3: Heat Map and Scatter Plot -->
        <div class="section-title">Heat Map and Scatter Plot</div>
        <div class="content-section">
            <p>Visualizing data through heat maps and scatter plots provides insights into EV adoption trends and charging station distribution across different regions.</p>
        </div>

        <!-- Section 4: Emissions of EVs Battery Production -->
        <div class="section-title">Emissions of Battery Production</div>
        <div class="content-section">
            <p>The production of EV batteries contributes to emissions, primarily due to mining and processing raw materials like lithium and cobalt. Efforts are ongoing to make this process more sustainable.</p>
        </div>

        <!-- Line Chart Section: EV Sales Over Time by Region and Powertrain -->
        <div class="section-title">EV Sales Over Time by Region and Powertrain</div>
        <div class="content-section">
            <div id="line-chart"></div>
        </div>

        <!-- Stacked Bar Chart Section -->
        <div id="stacked-bar-chart" class="content-section"></div>

    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Load the CSV data for EV sales
        d3.csv("Dev 1/datasets/EV_salesHistoricalCars.csv").then(function(data) {
            // Parse the data and convert relevant columns to numbers
            data.forEach(d => {
                d.year = +d.year;
                d.value = +d.value;
            });

            // Set margins and dimensions for the line chart
            const margin = { top: 50, right: 40, bottom: 50, left: 80 };
            const width = 1000 - margin.left - margin.right;
            const height = 600 - margin.top - margin.bottom;

            // Create the SVG container for the line chart
            const svg = d3.select("#line-chart")
                          .append("svg")
                          .attr("width", width + margin.left + margin.right)
                          .attr("height", height + margin.top + margin.bottom)
                          .append("g")
                          .attr("transform", `translate(${margin.left},${margin.top})`);

            // Define the scales
            const x = d3.scaleLinear()
                        .domain(d3.extent(data, d => d.year))
                        .range([0, width]);

            const y = d3.scaleLinear()
                        .domain([0, d3.max(data, d => d.value)])
                        .range([height, 0]);

            // Define line function
            const line = d3.line()
                           .x(d => x(d.year))
                           .y(d => y(d.value));

            // Group the data by region and powertrain type
            const regions = Array.from(new Set(data.map(d => d.region)));
            const powertrains = Array.from(new Set(data.map(d => d.powertrain)));

            // Create a color scale
            const color = d3.scaleOrdinal()
                            .domain(powertrains)
                            .range(d3.schemeCategory10);

            // Append X-axis and Y-axis
            svg.append("g")
               .attr("transform", `translate(0,${height})`)
               .call(d3.axisBottom(x).tickFormat(d3.format("d")))
               .append("text")
               .attr("x", width / 2)
               .attr("y", 40)
               .attr("class", "axis-label")
               .style("text-anchor", "middle")
               .text("Year");

            svg.append("g")
               .call(d3.axisLeft(y))
               .append("text")
               .attr("x", -40)
               .attr("y", height / 2)
               .attr("transform", "rotate(-90)")
               .attr("class", "axis-label")
               .style("text-anchor", "middle")
               .text("EV Sales (Units)");

            // Create a line for each powertrain type and region combination
            powertrains.forEach(function(powertrain) {
                // Filter data for the specific powertrain
                const powertrainData = data.filter(d => d.powertrain === powertrain);

                // Group the data by region
                regions.forEach(function(region) {
                    const regionData = powertrainData.filter(d => d.region === region);

                    // Draw the line for each region
                    svg.append("path")
                       .data([regionData])
                       .attr("class", "line")
                       .attr("fill", "none")
                       .attr("stroke", color(powertrain))
                       .attr("stroke-width", 2)
                       .attr("d", line)
                       .append("title")
                       .text(`${region} - ${powertrain}`);
                });
            });

            // Create a legend
            const legend = svg.append("g")
                              .attr("transform", `translate(${width - 150}, 20)`);

            powertrains.forEach((powertrain, i) => {
                legend.append("rect")
                      .attr("x", 0)
                      .attr("y", i * 20)
                      .attr("width", 10)
                      .attr("height", 10)
                      .style("fill", color(powertrain));

                legend.append("text")
                      .attr("x", 20)
                      .attr("y", i * 20 + 10)
                      .text(powertrain)
                      .attr("alignment-baseline", "middle");
            });
        });

         // Load the CSV data
        d3.csv("Dev 1/datasets/battery_emissions_dataset.csv").then(function(data) {
            const margin = { top: 50, right: 30, bottom: 50, left: 60 },
                  width = 800 - margin.left - margin.right,
                  height = 600 - margin.top - margin.bottom;

            const svg = d3.select("#stacked-bar-chart")
                          .append("svg")
                          .attr("width", width + margin.left + margin.right)
                          .attr("height", height + margin.top + margin.bottom)
                          .append("g")
                          .attr("transform", `translate(${margin.left},${margin.top})`);

            const emissionTypes = ["Mining Emissions (kg CO2e)", "Processing Emissions (kg CO2e)"];
            const countries = Array.from(new Set(data.map(d => d.Country)));

            data.forEach(d => {
                d["Mining Emissions (kg CO2e)"] = +d["Mining Emissions (kg CO2e)"];
                d["Processing Emissions (kg CO2e)"] = +d["Processing Emissions (kg CO2e)"];
            });

            const emissionsByCountry = d3.rollup(
                data,
                v => ({
                    "Mining Emissions (kg CO2e)": d3.sum(v, d => d["Mining Emissions (kg CO2e)"]),
                    "Processing Emissions (kg CO2e)": d3.sum(v, d => d["Processing Emissions (kg CO2e)"])
                }),
                d => d.Country
            );

            const formattedData = Array.from(emissionsByCountry, ([key, values]) => ({
                Country: key,
                ...values
            }));

            const stack = d3.stack().keys(emissionTypes);
            const stackedData = stack(formattedData);

            const x = d3.scaleBand()
                        .domain(countries)
                        .range([0, width])
                        .padding(0.2);

            const y = d3.scaleLinear()
                        .domain([0, d3.max(stackedData[stackedData.length - 1], d => d[1])])
                        .range([height, 0]);

            svg.append("g")
               .attr("transform", `translate(0,${height})`)
               .call(d3.axisBottom(x));

            svg.append("g")
               .call(d3.axisLeft(y));

            const color = d3.scaleOrdinal()
                            .domain(emissionTypes)
                            .range(["#1f77b4", "#ff7f0e"]);

            svg.selectAll("g.layer")
               .data(stackedData)
               .enter()
               .append("g")
               .attr("class", "layer")
               .attr("fill", d => color(d.key))
               .selectAll("rect")
               .data(d => d)
               .enter()
               .append("rect")
               .attr("x", d => x(d.data.Country))
               .attr("y", d => y(d[1]))
               .attr("height", d => y(d[0]) - y(d[1]))
               .attr("width", x.bandwidth());

            const legend = svg.append("g")
                              .attr("transform", `translate(${width - 150},20)`);

            emissionTypes.forEach((type, i) => {
                legend.append("rect")
                      .attr("x", 0)
                      .attr("y", i * 20)
                      .attr("width", 10)
                      .attr("height", 10)
                      .style("fill", color(type));

                legend.append("text")
                      .attr("x", 20)
                      .attr("y", i * 20 + 10)
                      .text(type)
                      .attr("alignment-baseline", "middle");
            });
        });
    </script>

    <footer>
        <p>Conclusion: Environmental Cost of Battery Production should also be taken into consideration.</p>
    </footer>

</body>
</html>

